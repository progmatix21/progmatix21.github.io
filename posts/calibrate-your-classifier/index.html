<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<title>Calibrate Your Classifier - Progmatix 21</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="Progmatix 21" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">Progmatix 21</div>
					<div class="logo__tagline">My learnings: byte by byte</div>
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">Calibrate Your Classifier</h1>
			<p class="post__lead">you might wonder how you were doing without it all along</p>
			<div class="post__meta meta">
<div class="meta__item-datetime meta__item">
	<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN" "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<svg version="1.1" id="Capa_1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" class="meta__icon icon icon-calendar" width="18" height="16" 
	 viewBox="0 0 458 458" style="enable-background:new 0 0 458 458;" xml:space="preserve">
<g>
	<path d="M111.938,135.598c11.046,0,20-8.954,20-20V21.597c0-11.046-8.954-20-20-20s-20,8.954-20,20v94.001
		C91.938,126.644,100.892,135.598,111.938,135.598z"/>
	<path d="M346.063,135.598c11.046,0,20-8.954,20-20V21.597c0-11.046-8.954-20-20-20s-20,8.954-20,20v94.001
		C326.063,126.644,335.017,135.598,346.063,135.598z"/>
	<path d="M443,82.403h-46.938c0,12.42,0,20.918,0,33.195c0,27.614-22.386,50-50,50c-27.614,0-50-22.386-50-50
		c0-12.281,0-20.771,0-33.195H161.938c0,12.42,0,20.918,0,33.195c0,27.614-22.386,50-50,50c-27.614,0-50-22.386-50-50
		c0-12.281,0-20.771,0-33.195H15c-8.284,0-15,6.716-15,15v89.641h458V97.403C458,89.119,451.284,82.403,443,82.403z"/>
	<path d="M0,441.403c0,8.284,6.716,15,15,15h428c8.284,0,15-6.716,15-15V227.044H0V441.403z M244.191,313.046
		c0-6.036,3.59-11.504,9.127-13.907c7.49-3.249,16.316-9.028,21.176-13.393c2.782-2.499,6.38-3.88,10.121-3.88h19.254
		c4.395,0,7.957,3.563,7.957,7.958v80.903h11.445c8.275,0,14.984,6.708,14.984,14.984c0,8.275-6.708,14.984-14.984,14.984h-59.934
		c-8.275,0-14.984-6.708-14.984-14.984c0-8.275,6.708-14.984,14.984-14.984h14.567V317.66c-2.163,2.886-6.797,6.077-12.243,8.754
		c-4.618,2.27-10.076,2.008-14.445-0.711c-4.369-2.718-7.025-7.501-7.025-12.647V313.046z M123.295,390.677
		c2.691-29.175,18.127-37.168,47.125-52.83c4.622-2.493,12.811-7.06,15.92-11.134c3.842-5.044,1.97-18.001-14.359-18.001
		c-5.549,0-11.094,1.106-17.704,5.967c-6.262,4.605-14.984,3.637-20.067-2.244l-0.594-0.688c-3.026-3.501-4.246-8.216-3.31-12.747
		s3.925-8.371,8.09-10.387c22.329-10.811,56.654-13.101,73.853,0.952c7.977,6.523,11.966,15.332,11.966,26.43
		c0,32.434-40.129,38.997-54.315,54.731h41.622c8.275,0,14.984,6.708,14.984,14.984c0,8.275-6.708,14.984-14.984,14.984h-79.1
		c-2.577,0-5.036-1.095-6.772-3C123.914,395.789,123.059,393.243,123.295,390.677z"/>
</g>
</svg>
<time class="meta__text" datetime="2023-12-17T11:13:10&#43;05:30">December 17, 2023</time></div>
<div class="meta__item-categories meta__item"><svg class="meta__icon icon icon-category" width="16" height="16" viewBox="0 0 16 16"><path d="m7 2l1 2h8v11h-16v-13z"/></svg><span class="meta__text"><a class="meta__link" href="/categories/data-science/" rel="category">Data Science</a>
	</span>
</div><div class="meta__item-categories meta__item">
	<span class="meta__text">
		<svg class="meta__icon icon icon-time" width="16" height="14" viewBox="0 0 30 28"><path d="M15 0C7 0 1 6 1 14s6 14 14 14 14-6 14-14S23 0 15 0zm0 25C9 25 4 20 4 14S9 3 15 3s11 5 11 11-5 11-11 11zm1-18h-2v8.4l6.8 4.4L22 18l-6-3.8V7z"/></svg>705 words/4 min read
	</span>
</div>
</div>
		</header>
		
<div class="post__toc toc">
	<div class="toc__title">Page content</div>
	<div class="toc__menu">
	    <details>
	        <summary>Click to toggle</summary>
		        <nav id="TableOfContents">
  <ul>
    <li><a href="#understanding-calibration">Understanding calibration</a></li>
    <li><a href="#why-is-calibration-important">Why is calibration important?</a></li>
    <li><a href="#classifier-calibration-in-action">Classifier calibration in action</a></li>
    <li><a href="#takeaway">Takeaway</a></li>
  </ul>
</nav>
		    </details>
	</div>
</div>
<div class="content post__content clearfix">
			
<style>
#myBtn {
  display: none;
  position: fixed;
  bottom: 20px;
  right: 30px;
  z-index: 99;
  font-size: 36px;
  font-weight: bold;
  border: none;
  outline: none;
  background-color: #444;
  color: white;
  cursor: pointer;
  padding: 15px;
  border-radius: 50%;
}

#myBtn:hover {
  background-color: #008080;
}
</style>

<button onclick="topFunction()" id="myBtn" title="Go to top">&#9650;</button>


<script>

let mybutton = document.getElementById("myBtn");


window.onscroll = function() {scrollFunction()};

function scrollFunction() {
  if (document.body.scrollTop > 1000 || document.documentElement.scrollTop > 1000) {
    mybutton.style.display = "block";
  } else {
    mybutton.style.display = "none";
  }
}


function topFunction() {
  document.body.scrollTop = 0;
  document.documentElement.scrollTop = 0;
}
</script>



<p>Calibration is easy enough to understand in the context of a weighing scale.
How would you map it to the world of machine learning?</p>
<h2 id="understanding-calibration">Understanding calibration</h2>
<p>Let&rsquo;s take an example from the world of weather forecasting.  Suppose we have
a weather forecast with 40% chance of rain &ndash; a probability of 0.4.  So considering the weather
forecast is a classifier predicting &lsquo;yes&rsquo; or &lsquo;no&rsquo; rain, is it well calibrated?
Now, you cannot check the calibration with just one day&rsquo;s forecast.  You need
to gather data of all forecasts with 40% rain and check whether it really
rained on about 40% of those days.  If it did then the prediction agrees with
the empirical observation.  If you broaden this exercise to include forecasts
of 10 to 90% rain and plot them against empirical observations, what you have
is a calibration curve for the forecast.  The better the agreement between the
forecast and the empirical observation, the better calibrated the forecast is.</p>
<h2 id="why-is-calibration-important">Why is calibration important?</h2>
<p>Calibration for classifiers is important in at least the following cases:</p>
<ul>
<li>When it is important to assign a probability to an observation.  Examples
are: probability of incidence of a condition.</li>
<li>When stacking classifiers, it is important that the upstream classifiers
and indeed the downstream ones as well are well calibrated.</li>
<li>For a more precise precision-recall tradeoff.</li>
<li>Even while predicting labels &ndash; where the classifier uses a default probability
threshold of 0.5 &ndash; an uncalibrated classifier can show very poor performance.</li>
</ul>
<p>Most classifiers come uncalibrated out-of-the-box for various reasons.  Tree-based
classifiers use entropy. Bayesian classifiers use the simplifying assumption of
feature-independence, while an SVM doesn&rsquo;t inherently give a probability score.</p>
<h2 id="classifier-calibration-in-action">Classifier calibration in action</h2>
<p>We examine classifier calibration in the context of a travel-customer-churn
dataset.  We share the code fragments only.  For the complete code in context,
refer to my <a href="https://www.kaggle.com/code/atrijtalgery/keras-calibration-pr-tradeoff">Kaggle notebook</a>.</p>
<p><img src="precalib.png" alt="precalibration curve"></p>
<p>The plot on the left reveals how far the classifier predictions are from the
ideal calibration line.  The predictions are either too pessimistic or
optimistic.  The histogram on the right shows an underconfident classifier that is shy of
predicting higher probability values for the positive case.</p>
<p>The process of calibration maps the classifier predictions (treating the classifier
as a black-box) so as to move the calibration curve closer to the ideal.</p>
<div class="highlight"><pre style=";-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#666">...</span>
<span style="color:#008000;font-weight:bold">from</span> <span style="color:#00f;font-weight:bold">sklearn.calibration</span> <span style="color:#008000;font-weight:bold">import</span> calibration_curve
<span style="color:#666">...</span>
<span style="color:#008000;font-weight:bold">from</span> <span style="color:#00f;font-weight:bold">scikeras.wrappers</span> <span style="color:#008000;font-weight:bold">import</span> KerasClassifier
<span style="color:#408080;font-style:italic"># Wrap the UNFITTED model to give us a scikit model</span>
sk_model <span style="color:#666">=</span> KerasClassifier(model<span style="color:#666">=</span>create_model, epochs<span style="color:#666">=</span><span style="color:#666">20</span>, batch_size<span style="color:#666">=</span><span style="color:#666">10</span>, verbose<span style="color:#666">=</span><span style="color:#666">0</span>)

<span style="color:#408080;font-style:italic"># Import the calibration infrastructure from sklearn</span>
<span style="color:#008000;font-weight:bold">from</span> <span style="color:#00f;font-weight:bold">sklearn.calibration</span> <span style="color:#008000;font-weight:bold">import</span> CalibratedClassifierCV, CalibrationDisplay

<span style="color:#408080;font-style:italic"># We use sigmoid calibration</span>
sk_model_sigmoid <span style="color:#666">=</span> CalibratedClassifierCV(sk_model, cv<span style="color:#666">=</span><span style="color:#666">2</span>, method<span style="color:#666">=</span><span style="color:#ba2121">&#34;sigmoid&#34;</span>)

<span style="color:#408080;font-style:italic"># Fit the model, remember this is an sklearn model</span>
sk_model_sigmoid<span style="color:#666">.</span>fit(X_train,y_train)

<span style="color:#408080;font-style:italic"># Get the prediction probabilities</span>
<span style="color:#408080;font-style:italic"># NOTE: THESE ARE PROBABILITIES, NOT LABELS</span>
calibrated_y_pred_proba <span style="color:#666">=</span> sk_model_sigmoid<span style="color:#666">.</span>predict_proba(X_test)[:,<span style="color:#666">1</span>]

<span style="color:#408080;font-style:italic"># reliability diagram eop-empirical observed probability, mpp-mean predicted probability</span>
eop, mpp <span style="color:#666">=</span> calibration_curve(y_test, calibrated_y_pred_proba, n_bins<span style="color:#666">=</span><span style="color:#666">10</span>)

fig, ax <span style="color:#666">=</span> plt<span style="color:#666">.</span>subplots(<span style="color:#666">1</span>,<span style="color:#666">2</span>,figsize<span style="color:#666">=</span>(<span style="color:#666">10</span>,<span style="color:#666">6</span>))

<span style="color:#408080;font-style:italic"># plot perfectly calibrated</span>
ax[<span style="color:#666">0</span>]<span style="color:#666">.</span>plot([<span style="color:#666">0</span>, <span style="color:#666">1</span>], [<span style="color:#666">0</span>, <span style="color:#666">1</span>], label<span style="color:#666">=</span><span style="color:#ba2121">&#34;ideal&#34;</span>, linestyle<span style="color:#666">=</span><span style="color:#ba2121">&#39;--&#39;</span>)
<span style="color:#408080;font-style:italic"># plot model reliability</span>
ax[<span style="color:#666">0</span>]<span style="color:#666">.</span>plot(mpp, eop, marker<span style="color:#666">=</span><span style="color:#ba2121">&#39;.&#39;</span>, label<span style="color:#666">=</span><span style="color:#ba2121">&#34;classifier&#34;</span>)
ax[<span style="color:#666">0</span>]<span style="color:#666">.</span>set(title<span style="color:#666">=</span><span style="color:#ba2121">&#34;Classifier reliability curve (calibrated)&#34;</span>, 
          xlabel<span style="color:#666">=</span><span style="color:#ba2121">&#34;mean classifier score&#34;</span>, 
          ylabel<span style="color:#666">=</span><span style="color:#ba2121">&#34;empirical frequency&#34;</span>)
ax[<span style="color:#666">0</span>]<span style="color:#666">.</span>legend()
ax[<span style="color:#666">0</span>]<span style="color:#666">.</span>grid()

<span style="color:#408080;font-style:italic"># plot probabilities histogram</span>
ax[<span style="color:#666">1</span>]<span style="color:#666">.</span>hist(calibrated_y_pred_proba,bins<span style="color:#666">=</span><span style="color:#666">10</span>)
ax[<span style="color:#666">1</span>]<span style="color:#666">.</span>set(title<span style="color:#666">=</span><span style="color:#ba2121">&#34;Predicted probability distribution (calibrated)&#34;</span>, 
       xlabel<span style="color:#666">=</span><span style="color:#ba2121">&#34;Mean predicted probability&#34;</span>, 
       ylabel<span style="color:#666">=</span><span style="color:#ba2121">&#34;Count&#34;</span>)
ax[<span style="color:#666">1</span>]<span style="color:#666">.</span>grid()

plt<span style="color:#666">.</span>tight_layout()
plt<span style="color:#666">.</span>show()
<span style="color:#666">...</span>
</code></pre></div><p>In the code fragment above, we use sklearn infrastructure to return a calibrated
classifier using sigmoid calibration.</p>
<blockquote>
<p>Note how we wrap <code>keras</code> model using <code>scikeras</code> adapter to conform to the
sklearn interface.</p>
</blockquote>
<p><img src="postcalib.png" alt="postcalibration curve"></p>
<p>The post-calibration plot shows a better behaved classifier whose probabilities
are closer to the ideal than its uncalibrated version.  The histogram on the
right shows a still underconfident classifier.</p>
<h2 id="takeaway">Takeaway</h2>
<p>You might now agree that classifier calibration is a very important step to
ensure more reliable predictions.  Fortunately, it is easy with the sklearn
library.  Indeed, calibration needs to be a step before evaluation as an attempt
to bring the best out of your classifier which you have so dilligently trained.</p>

		</div>
		<footer class="post__footer">
			
<div class="post__tags tags clearfix">
	<svg class="tags__badge icon icon-tag" width="16" height="16" viewBox="0 0 32 32"><path d="M32 19c0 1-1 2-1 2L21 31s-1 1-2 1-2-1-2-1L2 16c-1-1-1.4-2-1.4-2S0 12.5 0 11V3C0 1.5.8.8.8.8S1.5 0 3 0h8c1.5 0 3 .6 3 .6S15 1 16 2l15 15s1 1 1 2zM7 10a3 3 0 1 0 0-6 3 3 0 0 0 0 6z"/></svg>
	<ul class="tags__list">
		<li class="tags__item">
			<a class="tags__link btn" href="/tags/calibration/" rel="tag">calibration</a>
		</li>
		<li class="tags__item">
			<a class="tags__link btn" href="/tags/classification/" rel="tag">classification</a>
		</li>
	</ul>
</div>
		</footer>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/longest-common-subsequence/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">Longest Common Subsequence</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/are-outliers-always-a-problem/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">Are Outliers Always a Problem?</p>
		</a>
	</div>
</nav>




			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
<div class="footer__links">
	<a class="footer__link" href="/about/">About</a>
</div>
		<div class="footer__copyright">
			&copy; 2025 Atrij Talgery.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
	</div>
<script async defer src="/js/menu.js"></script>

<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.6/MathJax.js?config=TeX-AMS-MML_HTMLorMML" async></script>
</body>
</html>